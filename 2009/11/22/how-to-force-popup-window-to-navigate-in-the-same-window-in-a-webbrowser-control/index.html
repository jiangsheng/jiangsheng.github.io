<!doctype html><html><head><meta charset="UTF-8"<title>How to force popup window to navigate in the same window in a webbrowser control</head><body>When clicking on an <a> link that targets a new window,  the default behavior of a webbrowser control host application is to open a new window in </a><a class="zem_slink" title="Internet Explorer" href="http://en.wikipedia.org/wiki/Internet_Explorer" rel="wikipedia">Internet Explorer</a>. User ben_lai <a href="http://topic.csdn.net/u/20091120/11/b023d1e9-f31e-4671-bae7-45d6f4fca9e8.html">wants to know</a> how to handle the click and navigate to the same window.

There are three events that notifies a new window, <a href="http://msdn.microsoft.com/en-us/library/aa768335(v=VS.85).aspx">NewWindow</a> (The current documentation of this event is wong, check <a href="http://support.microsoft.com/kb/185538/EN-US/">http://support.microsoft.com/kb/185538/EN-US/</a> for the parameters of the event), <a href="http://msdn.microsoft.com/en-us/library/aa768336(v=VS.85).aspx">NewWindow2</a> and <a href="http://msdn.microsoft.com/en-us/library/aa768337(VS.85).aspx">NewWindow3</a>, each one has a cancel parameter to stop the new window being created, though for NewWindow2, it requires cooperation of <a href="http://msdn.microsoft.com/en-us/library/aa768326(v=VS.85).aspx">BeforeNavigate2</a> to get the url of the new window. After getting the url, the navigation can be carried out in the original window by calling Navigate2.

The obsolete NewWindow Event has the url right in the parameter so you can cancel the navigation and call the navigation methods of the <a class="zem_slink" title="Web browser" href="http://en.wikipedia.org/wiki/Web_browser" rel="wikipedia">webbrowser</a> control with the new url. The problem is, the event is there for compatibility purposes and you don’t know how long the event will still be raised. And it is not without problem, <a href="http://support.microsoft.com/kb/194242">one fixed bug causes a 60 seconds delay on new window creation</a>, <a href="http://support.microsoft.com/kb/294870">another causes the navigation to fail</a>. The fix for the latter? use NewWindow2.

The NewWindow2 event, introduced in IE4, does not have the url parameter. So you cannot simply cancel the event. To get the url, you need do the normal processing, create a hidden new webbrowser host window and <a href="http://support.microsoft.com/kb/184876">assign the webbrowser to the event’s ppdisp parameter</a>, then hook BeforeNavigate2 in the new window to get the url (may require client to <a href="http://support.microsoft.com/kb/943112">patch their Windows if they are on Windows Vista</a>). Once you get the url, you can destroy the new window and navigate in the old window.

The NewWindow3 event, introduced with <a class="zem_slink" title="Windows Server 2003" href="http://www.microsoft.com/windowsserver2003/" rel="homepage">Windows Server 2003 SP1</a> and <a class="zem_slink" title="Windows XP" href="http://www.microsoft.com/windows/windows-xp/default.aspx" rel="homepage">Windows XP SP2</a>, is designed for the webbrowser host to get notified of the decision of the <a class="zem_slink" title="Pop-up ad" href="http://en.wikipedia.org/wiki/Pop-up_ad" rel="wikipedia">popup window</a> manager based on user preference (for example, if the new window should be opened in a new window or a new tab in the current window), though the popup window manager’s behavior <a href="http://jiangshengvc.wordpress.com/2007/07/03/handle-newwindow3-and-showmodaldialog-in-chtmlview/http://jiangshengvc.wordpress.com/2007/07/03/handle-newwindow3-and-showmodaldialog-in-chtmlview/">can be customized too</a>. For the purpose of cancelling navigation and navigate to the old window, it does not matter how the new window should be opened, so you can just take the url and execute the same logic as in the NewWindow event. Since <strong>everyone should be using IE7 or higher now</strong>, the event should be supported by the browser. If the client can’t upgrade IE, at least ask them to fully patch their Windows.

The original poster’s question is in the VB forum so all the native events are available. For .net programmers, you can <a href="http://support.microsoft.com/kb/311298">hook up the event via IConnectionPointContainer directly if you are inserting the webbrowser as an ActievX on a Windows Form</a>, or <a href="http://www.codeproject.com/KB/cpp/ExtendedWebBrowser.aspx">extend the webbrowser site if you are using the System.Windows.Forms.Webbrowser class</a>. Update: <a class="zem_slink" title="Windows Presentation Foundation" href="http://en.wikipedia.org/wiki/Windows_Presentation_Foundation" rel="wikipedia">WPF</a> users who want to use System.Windows.Controls.WebBrowser are out of luck, they need to <a href="http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/8c43c6f5-4e9f-4491-8219-1b0eeb7b225b/">host the ActiveX versions of the webbrowser control to get a hand on the native events</a>.</body></html>