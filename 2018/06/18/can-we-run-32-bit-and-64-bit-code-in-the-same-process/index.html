<!doctype html><html><head><meta charset="UTF-8"<title>Can we run 32 bit and 64 bit code in the same process?</head><body><p>User redstone001 <a href="https://www.zhihu.com/question/267742897">wants to know</a> if it is possible to run 32 bit and 64 bit code in the same process – maybe in a different thread?</p><p>As <a href="https://en.wikipedia.org/wiki/Betteridge%27s_law_of_headlines">Betteridge's law of headlines</a> say, any news ending with a question mark can be answered with the word no. But this isn’t news, so … the answer is … yeah? Kind of.</p><p>The way that Windows <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa384274(v=vs.85).aspx">implements a 32 bit emulator</a> (e.g. making&nbsp; Program Files (x86) appear as Program Files to 32 bit processes) is to load 64 bit <strong>system</strong> dlls in 32 bit code… but specially crafted 64 bit dlls indeed. To be callable from a 32 bit process, everything they generate have to be 32 bit compatible. E.g. do not provide access outside of the x86 memory address space, and zero out higher 32 bit of handles etc. The way it is written is practically creating 64 bit dlls that enjoy none of the 64 bit benefits, but become much slower and heavier thanks to <a href="https://helgeklein.com/blog/2008/03/windows-x64-all-the-same-yet-very-different-part-5/">marshal 32 bit calls to 64 bit before calling other system dlls</a>. Because there is no up side except compatibility, Windows only allows its own 64 bit DLLs to be callable inside a 32 bit process. If you want to reuse your code written for a different CPU architecture, it would be much faster to run a separate process and do <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa365574(v=vs.85).aspx">interprocess communication</a>. </p></body></html>